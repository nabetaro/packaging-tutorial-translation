\documentclass[10pt,final]{beamer}
\mode<presentation>
\usetheme{lucasdeb}
\usepackage{wasysym}
\definecolor{darkgreen}{rgb}{0,.7,0}
\definecolor{darkred}{rgb}{.7,0,0}
\newcommand{\Smiley}{{\color{darkgreen}\smiley}}
\newcommand{\Frownie}{{\color{darkred}\frownie}}
\usepackage[utf8]{inputenc}
\usepackage{helvet}
\usepackage[OT1]{fontenc}
\usepackage{xspace}
\usepackage{verbatim}
\usepackage{comment}
\usepackage{tabularx}
\usepackage{listings}
\lstset{basicstyle=\ttfamily}
\beamertemplatetransparentcovereddynamic
\setbeamercovered{invisible}
\newcommand{\br}{\vskip 1em}
\newcommand{\hbr}{\vskip 0.5em}
\newcommand{\hhbr}{\vskip 0.25em}
\newcommand{\Arr}{\textbf{$\Rightarrow$}\xspace}
\newcommand{\arr}{\textbf{$\rightarrow$}\xspace}
\newcommand{\fixme}[1]{ {\color{red}\footnotesize\bf #1}}
\usepackage{listings}
\usepackage{tikz}
\usepackage{pgfplots}
\usetikzlibrary{dateplot}

\renewcommand{\ttdefault}{aett}
\usepackage{aecompl}

\newcommand{\pedp}{\NoAutoSpaceBeforeFDP}

\usebackgroundtemplate{\includegraphics[width=\paperwidth]{figs/dslide8.pdf}}
\logo{\includegraphics[viewport=274 335 360 440,width=0.5cm]{figs/openlogo-nd.pdf}}
\hypersetup{pdftitle={An Introduction to Debian Packaging},bookmarks}
\title{An Introduction to Debian Packaging}
\author[]{Lucas Nussbaum\\{\small\texttt{lucas@debian.org}}}
\institute{\includegraphics[viewport=274 335 360 440,width=1cm]{figs/openlogo-nd.pdf}}
\date{}

\newcommand{\nospace}[1]{{\NoAutoSpaceBeforeFDP{}#1}}%

\AtBeginSection[]
{
  \begin{frame}
    \frametitle{Outline}
    \tableofcontents[hideothersubsections]
  \end{frame}
}

\begin{document}

\frame{\titlepage}

\section{Introduction}
\subsection{Legal stuff}
\begin{frame}
\frametitle{Legal stuff}

Copyright \copyright 2011 Lucas Nussbaum -- lucas@debian.org
\br

{\small 
\textbf{This document is free software}: you can redistribute it and/or modify
it under either (at your option):
\hbr
\begin{itemize}
\item The terms of the GNU General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.\\
    \url{http://www.gnu.org/licenses/gpl.html}
    \br
\item The terms of the Creative Commons Attribution-ShareAlike 3.0 Unported License.\\
	\url{http://creativecommons.org/licenses/by-sa/3.0/}
\end{itemize}
}
\end{frame}

\subsection{About this tutorial}
\begin{frame}{About this tutorial}
\begin{itemize}
\item Goal: tell you what you really need to know about Debian packaging
	\br
\item Tries to keep a reasonable size
	\begin{itemize}
	\hbr
		\item No attempt to be complete
			\hbr
		\item You might need to read more documentation
	\end{itemize}
\end{itemize}
\vfill
\begin{itemize}
\item Latest version:\\
\url{http://git.debian.org/?p=users/lucas/packaging-tutorial.git}
	\br
\item Contribute:\\
	\texttt{git clone git://git.debian.org/\~{}lucas/packaging-tutorial.git}
	\br
\item Feedback: \href{mailto:lucas@debian.org}{\textbf{\texttt{lucas@debian.org}}}
\end{itemize}
\end{frame}

\subsection{The Deb package format}
\begin{frame}[fragile]
	\frametitle{Introduction: the Deb package format}
\begin{itemize}
	\item One of the two most common packages format (with RPM)
	\item Used by Debian and its derivatives (including Ubuntu)
	\item A very powerful and convenient way to distribute software to users
	\item \texttt{.deb} file: an \texttt{ar} archive
\begin{lstlisting}[basicstyle=\ttfamily\footnotesize]
$ ar tv wget_1.12-2.1_i386.deb
rw-r--r-- 0/0      4 Sep  5 15:43 2010 debian-binary
rw-r--r-- 0/0   2403 Sep  5 15:43 2010 control.tar.gz
rw-r--r-- 0/0 751613 Sep  5 15:43 2010 data.tar.gz
\end{lstlisting}
\begin{itemize}
	\item \texttt{debian-binary}: version of the deb file format, \texttt{"2.0\textbackslash{}n"}
	\item \texttt{control.tar.gz}: metadata about the package\\
		{\small \texttt{\textbf{control}, md5sums, (pre|post)(rm|inst), triggers, shlibs}, \ldots}
	\item \texttt{data.tar.gz}: data files of the package
\end{itemize}
\item You could create your \texttt{.deb} files manually\\
	{\footnotesize \url{http://tldp.org/HOWTO/html\_single/Debian-Binary-Package-Building-HOWTO/}}
\item But most people don't do it that way
\end{itemize}
\hbr
\centerline{\textbf{This tutorial: create Debian packages, the Debian way}}
\end{frame}

\subsection{Tools you will need}
\begin{frame}{Tools you will need}
	\begin{itemize}
		\item A Debian (or Ubuntu) system
			\br
		\item Some packages:
	\begin{itemize}
		\item \textbf{build-essential}: has dependencies on the packages that will be assumed to be available on the developers' machine (no need to specify them in the \texttt{Build-Depends:} control field of your package)
		\begin{itemize}
			\item includes a dependency on \textbf{dpkg-dev}, which contains basic Debian-specific tools to create packages
		\end{itemize}
		\hbr
	\item \textbf{devscripts}: contains many useful scripts for Debian maintainers
		\hbr
	\item \textbf{lintian}: package checker (static analyzer)
	\end{itemize}
	\end{itemize}

	\br
	Many other tools will also be mentioned later, such as \textbf{debhelper}, \textbf{cdbs}, \textbf{quilt}, \textbf{pbuilder}, \textbf{sbuild}, \textbf{svn-buildpackage}, \textbf{git-buildpackage}, \ldots
\end{frame}

\subsection{General packaging workflow}
\begin{frame}{General packaging workflow}
\begin{center}
\begin{tikzpicture}[
	node1/.style={shape=rectangle,draw=rouge,fill=debianbackgroundblue,thick},
	arr/.style={very thick},
	command/.style={text=rouge,font=\ttfamily},
]
	\node[node1] (us) at (1.5, 0) {upstream source};
	\node[node1] (da) at (-1.5, 0) {Debian mirror};
	\node[node1] (sp) at (0, -2) {source package};
	\draw[arr,<-,dashed] (sp) -- (2.5,-2) node[right=0cm,text width=2.98cm,text centered,font=\small] {where most of the manual work is done};
	\node[node1] (b1) at (-1.5, -4) {binary package};
	\node[node1] (b2) at (1.5, -4) {binary package};
	\draw[arr,<-,dashed] (b2) -- (3.5,-4) node[right,text centered,font=\ttfamily] {.deb\normalfont};
	\draw[arr,->] (us) -- (sp) node[pos=0.5,right,command] {dh\_make};
	\draw[arr,->] (da) -- (sp) node[pos=0.5,left,command] {apt-get source};
	\draw[arr,->] (sp) -- (b1);
	\draw[arr,->] (sp) -- (b2) node[pos=0.5,right] {\texttt{\color{rouge}debuild} (build and test with \texttt{\color{rouge}lintian})};
	\draw[arr,->] (0,-4.5) -- (-1,-6) node[pos=0.5,left] {install (\texttt{\color{rouge}debi})};
	\draw[arr,->] (0,-4.5) -- (1,-6) node[pos=0.5,right] {upload (\texttt{\color{rouge}dput})};
	\useasboundingbox (-4,-6) rectangle (6,0); % hack hack hack
\end{tikzpicture}
\end{center}
\end{frame}

\section{Creating source packages}
\subsection{Source packages basics}
\begin{frame}
\frametitle{Source package}
\begin{itemize}
	\item One source package can generate several binary packages\\
		{\small e.g the \texttt{\bfseries libtar} source generates the \texttt{\bfseries libtar} and \texttt{\bfseries libtar-dev} binary packages}
		\hbr
	\item Two kinds of packages: (if unsure, use non-native)
		\begin{itemize}
				\small
			\item Native packages: software developed inside Debian (\textsl{dpkg}, \textsl{apt})
			\item Non-native packages: software developed outside Debian
		\end{itemize}
		\hbr
	\item Main file: \texttt{.dsc} (metadata)
		\hbr
	\item Other files depending on the source format version
	\begin{itemize}
		\item 1.0 -- native: \texttt{package\_version.tar.gz}
		\hbr
		\item 1.0 -- non-native:
		\begin{itemize}
			\item \texttt{pkg\_ver.orig.tar.gz} : upstream source
			\item \texttt{pkg\_debver.diff.gz} : patch to add Debian-specific changes
		\end{itemize}
		\hbr
		\item 3.0 (quilt) -- also non-native, more recent:
		\begin{itemize}
			\item \texttt{pkg\_ver.orig.tar.gz} : upstream source
			\item \texttt{pkg\_debver.debian.tar.gz} : tarball with the Debian changes
		\end{itemize}
	\end{itemize}
\end{itemize}
\br
(See \texttt{dpkg-source(1)} for exact details)
\end{frame}

\begin{frame}[fragile]
	\frametitle{Source package example (wget\_1.12-2.1.dsc)}
\begin{lstlisting}[basicstyle=\ttfamily\small]
Format: 3.0 (quilt)
Source: wget
Binary: wget
Architecture: any
Version: 1.12-2.1
Maintainer: Noel Kothe <noel@debian.org>
Homepage: http://www.gnu.org/software/wget/
Standards-Version: 3.8.4
Build-Depends: debhelper (>> 5.0.0), gettext, texinfo, libssl-dev (>= 0.9.8), dpatch, info2man
Checksums-Sha1: 
 50d4ed2441e67db7aa5061d8a4dde41ee0e94248 2464747 wget_1.12.orig.tar.gz
 d4c1c8bbe431d6131cbd7ed2e4fc37dd7cef3611 48308 wget_1.12-2.1.debian.tar.gz
Checksums-Sha256: 
 7578ed0974e12caa71120581fa3962ee5a69f7175ddc3d6a6db0ecdcba65b572 2464747 wget_1.12.orig.tar.gz
 1e9b0c4c00eae6b4172baae219a14857f4002382b9d7a289de7ab789c402ad78 48308 wget_1.12-2.1.debian.tar.gz
Files: 
 141461b9c04e454dc8933c9d1f2abf83 2464747 wget_1.12.orig.tar.gz
 e93123c934e3c141916f472f380278c2 48308 wget_1.12-2.1.debian.tar.gz
\end{lstlisting}
\end{frame}

\subsection{Retrieving source packages}
\begin{frame}
\frametitle{Retrieving an existing source package}
\begin{itemize}
\item From the Debian archive:
	\begin{itemize}
		\item \texttt{apt-get source \textsl{package}}
		\item \texttt{apt-get source \textsl{package=version}}
		\item \texttt{apt-get source \textsl{package/release}}
	\end{itemize}
	(You need \texttt{deb-src} lines in \texttt{sources.list})
	\br
\item From the Internet:
	\begin{itemize}
		\item \texttt{dget \textsl{url-to.dsc}}
		\item \texttt{dget http://snapshot.debian.org/archive/debian-archive/\\20090802T004153Z/debian/dists/bo/main/source/web/\\wget\_1.4.4-6.dsc}\\
			(\href{http://snapshot.debian.org/}{\ttfamily snapshot.d.o} provides all packages from Debian since 2005)
	\end{itemize}
\br
\item Once downloaded, extract with \texttt{dpkg-source -x \textsl{file.dsc}}
\end{itemize}
\end{frame}

\subsection{Creating a basic source package}
\begin{frame}
\frametitle{Creating a basic source package}
\begin{itemize}
	\item Download the upstream source
		\hbr
	\item Rename to \texttt{\textsl{source\_package}\_\textsl{upstream\_version}.orig.tar.gz}
		\hbr
	\item Untar it
		\hbr
	\item \texttt{cd \textsl{upstream\_source} \&\& dh\_make} (from the \textbf{dh-make} package)
		\hbr
	\item There are some alternatives to \texttt{dh\_make} for specific sets of packages: \textbf{dh-make-perl}, \textbf{dh-make-php}, \ldots
		\hbr
	\item \texttt{debian/} directory created, with a lot of files in it
\end{itemize}
\end{frame}

\subsection{Files in debian/}
\begin{frame}{Files in debian/}
	All the packaging work should usually be made by modifying files in \texttt{debian/}
\hbr
\begin{itemize}
	\item Main files:
	\begin{itemize}
		\item changelog
		\item copyright
		\item control
		\item rules
	\end{itemize}
	\hbr
	\item Optional files:
	\begin{itemize}
		\item compat
		\item watch
		\item dh\_install* targets\\
			{\small *.dirs, *.docs, *.manpages, \ldots}
		\item maintainer scripts\\
			{\small *.postinst, *.prerm, \ldots}
		\item source/format
		\item patches
	\end{itemize}
\end{itemize}
\end{frame}

\begin{frame}[fragile]{debian/changelog}
	\begin{itemize}
		\item Lists the Debian packaging changes
		\item Edited manually or with \texttt{dch}
		\item Special format to automatically close Debian or Ubuntu bugs\\
			Debian: \texttt{Closes:~\#595268} ; Ubuntu: \texttt{LP:~\#616929}
		\item Installed as \texttt{/usr/share/doc/\textit{package}/changelog.Debian.gz} in your package
	\end{itemize}
\begin{lstlisting}[basicstyle=\ttfamily\footnotesize]
mpich2 (1.2.1.1-5) unstable; urgency=low

  * Use /usr/bin/python instead of /usr/bin/python2.5. Allow
    to drop dependency on python2.5.  Closes: #595268
  * Make /usr/bin/mpdroot setuid. This is the default after
    the installation of mpich2 from source, too. LP: #616929
    + Add corresponding lintian override.

 -- Lucas Nussbaum <lucas@debian.org>  Wed, 15 Sep 2010 18:13:44 +0200
\end{lstlisting}
\end{frame}

\begin{frame}[fragile]{debian/copyright}
	\hbr
	\begin{itemize}
		\item Copyright and license information for the source and the packaging
		\item Traditionally written as a text file
		\item New machine-readable format: \url{http://dep.debian.net/deps/dep5/}
	\end{itemize}
\begin{lstlisting}[basicstyle=\ttfamily\footnotesize]
Format: <VERSIONED_FORMAT_URL>
Upstream-Name: X Solitaire
Source: ftp://ftp.example.com/pub/games

Files: *
Copyright: Copyright 1998 John Doe <jdoe@example.com>
License: GPL-2+
 This program is free software; you can redistribute it
 [...]
 .
 On Debian systems, the full text of the GNU General Public
 License version 2 can be found in the file
 `/usr/share/common-licenses/GPL-2'.

Files: debian/*
Copyright: Copyright 1998 Jane Smith <jsmith@example.net>
License:
 [LICENSE TEXT]
\end{lstlisting}
\end{frame}

\begin{frame}[fragile]{debian/control}
	\hbr
	\begin{itemize}
		\item Package metadata
			\begin{itemize}
				\item For the source package itself
				\item For each binary package built from this source
			\end{itemize}
			\hbr
		\item Package name, section, priority, maintainer, uploaders, build-dependencies, dependencies, description, homepage, \ldots
			\hbr
		\item Documentation: Debian Policy chapter 5\\
			\url{http://www.debian.org/doc/debian-policy/ch-controlfields.html}
	\end{itemize}
\begin{lstlisting}[basicstyle=\ttfamily\footnotesize]
Source: wget
Section: web
Priority: important
Maintainer: Noel Kothe <noel@debian.org>
Build-Depends: debhelper (>> 5.0.0), gettext, texinfo,
 libssl-dev (>= 0.9.8), dpatch, info2man
Standards-Version: 3.8.4
Homepage: http://www.gnu.org/software/wget/

Package: wget
Architecture: any
Depends: ${shlibs:Depends}, ${misc:Depends}
Description: retrieves files from the web
 Wget is a network utility to retrieve files from the Web
\end{lstlisting}
\end{frame}

\begin{frame}{Architecture: all or any}
Two kinds of binary packages:
\hbr
\begin{itemize}
	\item Packages with a different content on each Debian architecture
	\begin{itemize}
	\item Example: C program
	\item \texttt{Architecture:\ any} in \texttt{debian/control}
		\begin{itemize}
			\item Or, if it only works on a subset of architectures:\\
				\texttt{Architecture:\ amd64 i386 ia64 hurd-i386}
		\end{itemize}
	\item Packages for other architectures built by the Debian infrastructure
	\item Named \texttt{\textsl{package}\_\textsl{version}\_\textsl{architecture}.deb}
	\end{itemize}
\br
	\item Packages with the same content on all architectures
	\begin{itemize}
	\item Example: Perl library
	\item \texttt{Architecture:\ all} in \texttt{debian/control}
	\item Named \texttt{\textsl{package}\_\textsl{version}\_\textbf{all}.deb}
\end{itemize}
\end{itemize}
\end{frame}

\begin{frame}[fragile]{debian/rules}
	\hbr
	\begin{itemize}
		\item Makefile
			\br
		\item Interface used to build Debian packages
			\br
		\item Documented in Debian Policy, chapter 4.8\\
			{\small \texttt{http://www.debian.org/doc/debian-policy/ch-source.html\#s-debianrules}}
			\br
		\item Five required targets:
		\begin{itemize}
			\item \texttt{build}: should perform all the configuration and compilation of the package
				\hbr
			\item \texttt{binary, binary-arch, binary-indep}: build the binary packages produced by this source package
				\begin{itemize}
					\item \texttt{dpkg-buildpackage} will call \texttt{binary} to build all the packages, or \texttt{binary-arch} to build only the \texttt{Architecture:~any} packages
				\end{itemize}
				\hbr
			\item \texttt{clean}: clean up the source directory
		\end{itemize}
	\end{itemize}
\end{frame}

\subsection{Packaging helpers}
\begin{frame}{Packaging helpers -- debhelper}
\begin{itemize}
	\item You could write shell code in \texttt{debian/rules} directly
	\begin{itemize}
		\item See the \texttt{adduser} package for example
	\end{itemize}
	\hbr
	\item But most packages in Debian use a \textsl{Packaging helper}
	\hbr
	\item Most popular one: \textbf{debhelper} (used by 98\% of packages)
	\hbr
	\item Goal: factor the common tasks in external tools used by all packages\\
		{\footnotesize dh\_installdirs, dh\_installchangelogs, dh\_installdocs, dh\_installexamples, dh\_install, dh\_installdebconf, dh\_installinit, dh\_link, dh\_strip, dh\_compress, dh\_fixperms, dh\_perl, dh\_makeshlibs, dh\_installdeb, dh\_shlibdeps, dh\_gencontrol, dh\_md5sums, dh\_builddeb, \ldots}
		\begin{itemize}
			\item Called from \texttt{debian/rules}
			\item Behaviour changed using command parameters or files in \texttt{debian/}\\
				{\footnotesize \ttfamily dirs, package.docs, package.examples, package.install, package.menu, package.logrotate, package.manpages, \ldots}
		\end{itemize}
	\hbr
\item Third-party helpers for sets of packages: \textbf{python-support}, \textbf{dh\_ocaml}, \ldots
	\hbr
\item Gotcha: \texttt{debian/compat}: Debhelper compatibility version (use "7")
\end{itemize}
\end{frame}

\begin{frame}[fragile]{debian/rules using debhelper (1/2)}
\begin{lstlisting}[basicstyle=\ttfamily\footnotesize]
#!/usr/bin/make -f

# Uncomment this to turn on verbose mode.
#export DH_VERBOSE=1

build: 
        $(MAKE)
        #docbook-to-man debian/packagename.sgml > packagename.1

clean: 
        dh_testdir
        dh_testroot
        rm -f build-stamp configure-stamp
        $(MAKE) clean
        dh_clean 

install: build
        dh_testdir
        dh_testroot
        dh_clean -k 
        dh_installdirs
        # Add here commands to install the package into debian/packagename.
        $(MAKE) DESTDIR=$(CURDIR)/debian/packagename install
\end{lstlisting}
\end{frame}

\begin{frame}[fragile]{debian/rules using debhelper (2/2)}
\begin{lstlisting}[basicstyle=\ttfamily\footnotesize]

# Build architecture-independent files here.
binary-indep: build install

# Build architecture-dependent files here.
binary-arch: build install
        dh_testdir
        dh_testroot
        dh_installchangelogs 
        dh_installdocs
        dh_installexamples
#       dh_install
        dh_installman
        dh_link
        dh_strip
        dh_compress
        dh_fixperms
        dh_installdeb
        dh_shlibdeps
        dh_gencontrol
        dh_md5sums
        dh_builddeb

binary: binary-indep binary-arch
.PHONY: build clean binary-indep binary-arch binary install configure
\end{lstlisting}
\end{frame}

\begin{frame}[fragile]{CDBS}
\hbr
\begin{itemize}
\item Still a lot of redundancy between packages
\hbr
\item Second-level helpers that factor what packages typically require
	\begin{itemize}
	\item Building with \texttt{./configure \&\& make \&\& make install}, CMake
	\item Support for Perl, Python, Ruby, GNOME, KDE, Java, Haskell, \ldots
	\end{itemize}
\hbr
\item CDBS:
	\begin{itemize}
		\item Introduced in 2005, based on advanced \textsl{GNU make} magic
		\item Documentation: \texttt{/usr/share/doc/cdbs/}
		\item But some people hate it:
			\begin{itemize}
				\item Sometimes difficult to customize package builds:\\
				"\textsl{twisty maze of makefiles, environment vars and black magic}"
				\item Slower than plain debhelper (many useless calls to dh\_*)
			\end{itemize}
\begin{lstlisting}[basicstyle=\ttfamily\footnotesize]
#!/usr/bin/make -f
include /usr/share/cdbs/1/rules/debhelper.mk
include /usr/share/cdbs/1/class/autotools.mk

# add an action after the build
build/mypackage::
    /bin/bash debian/scripts/foo.sh
\end{lstlisting}
	\end{itemize}
\end{itemize}
\end{frame}

\begin{frame}[fragile]{Debhelper 7 (aka dh7, or just dh)}
\begin{itemize}
\item Introduced in 2008 as a \textsl{CDBS killer}
\hbr
\item \textbf{dh} command that calls \texttt{dh\_*}
\hbr
\item Simple \textsl{debian/rules}, listing only overrides
\hbr
\item Easier to customize than CDBS
\hbr
\item Doc: slides from Joey Hess' Debconf9 talk\\\
	\url{http://kitenet.net/~joey/talks/debhelper/debhelper-slides.pdf}
	\br
\begin{lstlisting}[basicstyle=\ttfamily\footnotesize]
#!/usr/bin/make -f
%:
    dh $@

override_dh_auto_configure:
     dh_auto_configure -- --with-kitchen-sink

override_dh_auto_build:
     make world

\end{lstlisting}
\end{itemize}
\end{frame}

\begin{frame}{Plain debhelper vs CDBS vs debhelper 7}
	\hbr
\begin{itemize}
\item Market shares: (feb'11)\\
Plain debhelper: 45\% \hskip 1em CDBS: 24\% \hskip 1em  debhelper7: 29\%
\hbr
\item Which one should I learn?
\begin{itemize}
	\item Probably all of them
	\item You need to know debhelper to use CDBS and dh7
	\item You might have to modify CDBS packages
\end{itemize}
\hbr
\item Which one should I use for a new package?
\begin{itemize}
	\item Debhelper 7 (only solution with an increasing market share)
\end{itemize}
\end{itemize}

\hbr
\begin{center}
\begin{tikzpicture}
\begin{axis}[small,label style={font=\footnotesize},xlabel={\small Time},ylabel={\small Market share (\%)},
	date coordinates in=x,height=4.85cm,width=9cm,xticklabel={\month/\year},
	     legend style={font=\footnotesize,at={(1.02,1)},anchor=north west},max space between ticks=82,try min ticks=5,ymin=0]
	\addplot[mark=none,blue,thick] table[x=date,y=dh] {cdbs-dh7.txt};
	\addplot[mark=none,red,thick] table[x=date,y=dh7] {cdbs-dh7.txt};
	\addplot[mark=none,green,thick] table[x=date,y=cdbs] {cdbs-dh7.txt};
	\legend{debhelper, dh7, CDBS}
\end{axis}
\end{tikzpicture}
\end{center}

\end{frame}

\section{Building and testing packages}
\subsection{Building packages}
\subsection{Testing packages}

\section{Practical session 1 : modifying the wget package}
\begin{frame}{Practical session 1: modifying the wget package}
\begin{enumerate}
	\item Go to \url{http://ftp.debian.org/debian/pool/main/w/wget/} and
		download version 1.12-2.1 of the package
	\item Look at the files in \texttt{debian/}.
		\begin{itemize}
			\item 		How many binary packages are generated by this source package?
			\item 		Which packaging helper does this package use?
		\end{itemize}
	\item Build the package
	\item We are now going to modify the package. Add a changelog entry and increase the version number.
	\item The lintian warning \textsl{more-than-one-patch-system} is caused by the build-dependency on \texttt{dpatch}. Remove it, and add an appropriate changelog entry.
	\item Now disable IPv6 support (it is a \texttt{./configure} option)
	\item Rebuild the package
	\item Install the newly built package
	\item Compare the original and the new package with debdiff
\end{enumerate}
\end{frame}

\section{Maintaining packages in Debian}
\subsection{Becoming a Debian contributor}
\begin{frame}
\frametitle{Becoming a Debian contributor}
Several ways to contribute:
\hbr
\begin{itemize}
\item Bring new software to Debian
\begin{itemize}
\item Is that new software interesting/useful enough?
\item Are there alternatives already packaged in Debian?
\end{itemize}
\br
\item Adopt existing unmaintained packages
\begin{itemize}
	\item Many unmaintained packages in Debian
	\item Including some that you rely on, probably
	\item Use \texttt{wnpp-alert} to find out if you have some installed
\end{itemize}
\br
\item Get involved in packaging teams
\begin{itemize}
\item Many teams that focus on set of packages, and need help
\item Full list on \url{http://wiki.debian.org/Teams}
\item An excellent way to work with more experienced contributors
\end{itemize}
\end{itemize}
\end{frame}

\subsection{More interested in Ubuntu?}
\begin{frame}
\frametitle{More interested in Ubuntu?}
\begin{itemize}
	\item Ubuntu mainly manages the divergence with Debian
	\br
	\item Do not really focus on specific packages\\
		Instead, collaborate with Debian teams
	\br
	\item Usually recommend uploading new packages to Debian first\\
		\url{https://wiki.ubuntu.com/UbuntuDevelopment/NewPackages/}
	\br
	\item Possibly a better plan:
	\begin{itemize}
		\item Get involved in a Debian team and act as a bridge with Ubuntu
			\hbr
		\item Help reduce divergence, triage bugs in Launchpad
			\hbr
		\item Many Debian tools can help:
		\begin{itemize}
		\item Ubuntu column on the Developer' packages overview
		\item Ubuntu box on the Packages Tracking System
		\item Receive launchpad bugmail via the PTS
		\end{itemize}
	\end{itemize}
\end{itemize}
\end{frame}

\subsection{Adopting orphaned packages}
\begin{frame}{Adopting orphaned packages}
\begin{itemize}
	\item Full list: \url{http://www.debian.org/devel/wnpp/}
	\item Installed on your machine: \texttt{wnpp-alert}
	\item Different states:
	\begin{itemize}
		\item \textbf{O}rphaned: the package is unmaintained\\
			Feel free to adopt it
		\item \textbf{RFA}: \textbf{R}equest \textbf{F}or \textbf{A}dopter\\
			Maintainer looking for adopter, but continues work in the meantime\\
			Feel free to adopt it. A mail to the current maintainer is polite
		\item \textbf{ITA}: \textbf{I}ntent \textbf{T}o \textbf{A}dopt\\
			Someone intends to adopt the package\\
			You could propose your help!
		\item \textbf{RFH} (\textbf{R}equest \textbf{F}or \textbf{H}elp\\
			The maintainer is looking for help
	\end{itemize}
	\item Some unmaintained packages not detected \arr not orphaned yet
	\item When in doubt, ask \texttt{debian-qa@lists.debian.org}
	\end{itemize}
\end{frame}


\section{Resources}
\subsection{Where to find help?}
\begin{frame}
\frametitle{Where to find help?}
Help you will need:
\begin{itemize}
	\item Various advices and answers to your questions, code reviews
	\item Sponsorship of your uploads, when your package is ready
\end{itemize}
\br
You can get help from:
\begin{itemize}
	\item Other members of a packaging team $\leftarrow$ the best solution
		\begin{itemize}
			\item They know the specifics of your package
			\item You can become a member of the team
			\item See \url{http://wiki.debian.org/Teams}
		\end{itemize}
	\hbr
	\item The Debian Mentors group (if your package doesn't fit in a team)
		\begin{itemize}
			\item \url{http://wiki.debian.org/DebianMentorsFaq}
			\item Mailing list: \url{debian-mentors@lists.debian.org}
			\item IRC: \texttt{\#debian-mentors} on \texttt{irc.debian.org}
			\item \url{http://mentors.debian.net/}
		\end{itemize}
\end{itemize}
\end{frame}

\subsection{Official documentation}
\begin{frame}{Official documentation}
	\begin{itemize}
		\item Debian Developers' Corner\\
			\url{http://www.debian.org/devel/}\\
			{\small Links to many resources about Debian development}
			\hbr
		\item Debian New Maintainers' Guide\\
			\url{http://www.debian.org/doc/maint-guide/}\\
			{\small An introduction to Debian packaging, but could use an update}
			\hbr
		\item Debian Developer's Reference\\
		      \url{http://www.debian.org/doc/developers-reference/}\\
		      {\small Mostly about Debian procedures, but also some best packaging practices (part 6)}
			\hbr

	      \item Debian Policy\\
		    \url{http://www.debian.org/doc/debian-policy/}\\
		    {\small All the requirements that every package must satisfy}
			\hbr

		\item Ubuntu Packaging Guide\\
			\url{https://wiki.ubuntu.com/PackagingGuide}
	\end{itemize}
\end{frame}

\section{TODO}
\begin{frame}
	\frametitle{Things not covered (yet)}
Packaging:
\begin{itemize}
\item Example: removing IPv6 support from wget
\item New source formats
\item Modifying the upstream source + patch systems
\item Maintainer scripts
\item Debconf
\item watch
\end{itemize}
Processes:
\begin{itemize}
\item Building packages -- dpkg-buildpackage pbuilder sbuild debi lintian debdiff debc
\item Uploading debsign / dput -- private archive -- reprepro
\item Packaging with VCSes debcheckout debcommit debrelease git-buildpackage svn-buildpackage
\end{itemize}
\end{frame}


\end{document}
