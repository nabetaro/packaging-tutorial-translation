\documentclass[10pt,final,handout]{beamer}
\mode<presentation>
\usetheme{lucasdeb}
\usepackage{paralist}
\usepackage{wasysym}
\definecolor{darkgreen}{rgb}{0,.7,0}
\definecolor{darkred}{rgb}{.7,0,0}
\newcommand{\Smiley}{{\color{darkgreen}\smiley}}
\newcommand{\Frownie}{{\color{darkred}\frownie}}
\usepackage[utf8]{inputenc}
\usepackage{helvet}
\usepackage[OT1]{fontenc}
\usepackage{xspace}
\usepackage{verbatim}
\usepackage{comment}
\usepackage{tabularx}
\usepackage{listings}
\lstset{basicstyle=\ttfamily}
\beamertemplatetransparentcovereddynamic
\setbeamercovered{invisible}
\newcommand{\br}{\vskip 1em}
\newcommand{\hbr}{\vskip 0.5em}
\newcommand{\hhbr}{\vskip 0.25em}
\newcommand{\Arr}{\textbf{$\Rightarrow$}\xspace}
\newcommand{\arr}{\textbf{$\rightarrow$}\xspace}
\newcommand{\fixme}[1]{ {\color{red}\footnotesize\bf #1}}
\usepackage{listings}
\usepackage{tikz}

\renewcommand{\ttdefault}{aett}
\usepackage{aecompl}

\newcommand{\pedp}{\NoAutoSpaceBeforeFDP}

\usebackgroundtemplate{\includegraphics[width=\paperwidth]{figs/dslide8.pdf}}
\logo{\includegraphics[viewport=274 335 360 440,width=0.5cm]{figs/openlogo-nd.pdf}}
\hypersetup{pdftitle={An Introduction to Debian Packaging},bookmarks}
\title{An Introduction to Debian Packaging}
\author[]{Lucas Nussbaum\\{\small\texttt{lucas@debian.org}}}
\institute{\includegraphics[viewport=274 335 360 440,width=1cm]{figs/openlogo-nd.pdf}}
\date{}

\newcommand{\nospace}[1]{{\NoAutoSpaceBeforeFDP{}#1}}%

\begin{document}

\frame{\titlepage}

\section{Introduction}
\subsection{Legal stuff}
\begin{frame}
\frametitle{Legal stuff}

Copyright \copyright 2011 Lucas Nussbaum -- lucas@debian.org
\br

{\small 
This document is free software: you can redistribute it and/or modify
it under either (at your option):
\begin{itemize}
\item The terms of the GNU General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.\\
    \url{http://www.gnu.org/licenses/gpl.html}
    \hbr
\item The terms of the Creative Commons Attribution-ShareAlike 3.0 Unported License.\\
	\url{http://creativecommons.org/licenses/by-sa/3.0/}
\end{itemize}
}
\end{frame}

\subsection{About this tutorial}
\begin{frame}{About this tutorial}
\begin{itemize}
\item Goal: tell you what you really need to know about Debian packaging
	\br
\item Tries to keep a reasonable size
	\begin{itemize}
	\hbr
		\item No attempt to be complete
			\hbr
		\item You might need to read more documentation
	\end{itemize}
\end{itemize}
\vfill
\begin{itemize}
\item Latest version:\\
\url{http://git.debian.org/?p=users/lucas/packaging-tutorial.git}
	\br
\item Contribute:\\
	\texttt{git clone git://git.debian.org/\~{}lucas/packaging-tutorial.git}
	\br
\item Feedback: \href{mailto:lucas@debian.org}{\textbf{\texttt{lucas@debian.org}}}
\end{itemize}
\end{frame}

\subsection{The Deb package format}
\begin{frame}[fragile]
	\frametitle{Introduction: the Deb package format}
\begin{itemize}
	\item One of the two most common packages format (with RPM)
	\item Used by Debian and its derivatives (including Ubuntu)
	\item A very powerful and convenient way to distribute software to users
		\pause
	\item \texttt{.deb} file: an \texttt{ar} archive
\begin{lstlisting}[basicstyle=\ttfamily\footnotesize]
$ ar tv wget_1.12-2.1_i386.deb
rw-r--r-- 0/0      4 Sep  5 15:43 2010 debian-binary
rw-r--r-- 0/0   2403 Sep  5 15:43 2010 control.tar.gz
rw-r--r-- 0/0 751613 Sep  5 15:43 2010 data.tar.gz
\end{lstlisting}
\begin{itemize}
	\item \texttt{debian-binary}: version of the deb file format, \texttt{"2.0\textbackslash{}n"}
	\item \texttt{control.tar.gz}: metadata about the package\\
		{\small \texttt{\textbf{control}, md5sums, (pre|post)(rm|inst), triggers, shlibs}, \ldots}
	\item \texttt{data.tar.gz}: data files of the package
\end{itemize}
		\pause
\item You could create your \texttt{.deb} files manually\\
	{\footnotesize \url{http://tldp.org/HOWTO/html\_single/Debian-Binary-Package-Building-HOWTO/}}
\item But most people don't do it that way
\end{itemize}
\hbr
\centerline{\textbf{This tutorial: create Debian packages, the Debian way}}
\end{frame}

\subsection{Tools you will need}
\begin{frame}{Tools you will need}
	\begin{itemize}
		\item A Debian (or Ubuntu) system
			\br
		\item \textbf{build-essential} package: has dependencies on the packages that will be assumed to be available on the developers' machine (no need to specify them in the \texttt{Build-Depends:} control field)
		\begin{itemize}
			\item includes a dependency on \textbf{dpkg-dev}, which contains basic Debian-specific tools to create packages
		\end{itemize}
		\br
	\item \textbf{devscripts} package: contains many useful scripts for Debian maintainers
	\end{itemize}

	\br
	Many other tools will also be mentioned later, such as \textbf{debhelper}, \textbf{cdbs}, \textbf{quilt}, \textbf{pbuilder}, \textbf{sbuild}, \textbf{svn-buildpackage}, \textbf{git-buildpackage}, \ldots
\end{frame}

\subsection{General packaging workflow}
\begin{frame}{General packaging workflow}
\begin{center}
\begin{tikzpicture}[
	node1/.style={shape=rectangle,draw=rouge,fill=debianbackgroundblue,thick},
	arr/.style={very thick},
	command/.style={text=rouge,font=\ttfamily},
]
	\node[node1] (us) at (1.5, 0) {upstream source};
	\node[node1] (da) at (-1.5, 0) {Debian mirror};
	\node[node1] (sp) at (0, -1.5) {source package};
	\draw[arr,<-,dashed] (sp) -- (2.5,-1.5) node[right=0cm,text width=2.98cm,text centered,font=\small] {where most of the manual work is done};
	\node[node1] (b1) at (-1.5, -3) {binary package};
	\node[node1] (b2) at (1.5, -3) {binary package};
	\draw[arr,<-,dashed] (b2) -- (3.5,-3) node[right,text centered,font=\ttfamily] {.deb\normalfont};
	\draw[arr,->] (us) -- (sp) node[pos=0.5,right,command] {dh\_make};
	\draw[arr,->] (da) -- (sp) node[pos=0.5,left,command] {apt-get source};
	\draw[arr,->] (sp) -- (b1);
	\draw[arr,->] (sp) -- (b2) node[pos=0.5,right,command] {debuild};
	\node (dot) at (0,-4.5) {};
	\draw[fill=black] (dot) circle (.05cm);
	\draw[arr,->] (0,-3.5) -- (dot) node[pos=0.5,right] {test (\texttt{\color{rouge}lintian})};
	\draw[arr,->] (dot) -- (-1,-5.5) node[pos=0.5,left] {install (\texttt{\color{rouge}debi})};
	\draw[arr,->] (dot) -- (1,-5.5) node[pos=0.5,right] {upload (\texttt{\color{rouge}dput})};
	\useasboundingbox (-4,-6) rectangle (6,0); % hack hack hack
\end{tikzpicture}
\end{center}
\end{frame}

\section{Creating source packages}
\subsection{Source packages formats}
\begin{frame}
\frametitle{Source package}
\begin{itemize}
	\item One source package can generate several binary packages\\
		{\small the \texttt{\bfseries libtar} source generates the \texttt{\bfseries libtar} and \texttt{\bfseries libtar-dev} binary packages}
		\hbr
	\item Two kinds of packages: (if unsure, use non-native)
		\begin{itemize}
				\small
			\item Native packages: software developed inside Debian (\textsl{dpkg}, \textsl{apt})
			\item Non-native packages: software developed outside Debian
		\end{itemize}
		\hbr
	\item Main file: \texttt{.dsc} (metadata)
		\hbr
	\item Other files depending on the source format version
	\begin{itemize}
		\item 1.0 -- native: \texttt{package\_version.tar.gz}
		\hbr
		\item 1.0 -- non-native:
		\begin{itemize}
			\item \texttt{pkg\_ver.orig.tar.gz} : upstream source
			\item \texttt{pkg\_debver.diff.gz} : patch to add Debian-specific changes
		\end{itemize}
		\hbr
		\item 3.0 (quilt) -- also non-native, more recent:
		\begin{itemize}
			\item \texttt{pkg\_ver.orig.tar.gz} : upstream source
			\item \texttt{pkg\_debver.debian.tar.gz} : tarball with the Debian changes
		\end{itemize}
	\end{itemize}
\end{itemize}
\br
(See \texttt{dpkg-source(1)} for exact details)
\end{frame}

\subsection{Source package example}
\begin{frame}[fragile]
	\frametitle{Source package example (wget\_1.12-2.1.dsc)}
\begin{lstlisting}[basicstyle=\ttfamily\footnotesize]
Format: 3.0 (quilt)
Source: wget
Binary: wget
Architecture: any
Version: 1.12-2.1
Maintainer: Noel Kothe <noel@debian.org>
Homepage: http://www.gnu.org/software/wget/
Standards-Version: 3.8.4
Build-Depends: debhelper (>> 5.0.0), gettext, texinfo, libssl-dev (>= 0.9.8), dpatch, info2man
Checksums-Sha1: 
 50d4ed2441e67db7aa5061d8a4dde41ee0e94248 2464747 wget_1.12.orig.tar.gz
 d4c1c8bbe431d6131cbd7ed2e4fc37dd7cef3611 48308 wget_1.12-2.1.debian.tar.gz
Checksums-Sha256: 
 7578ed0974e12caa71120581fa3962ee5a69f7175ddc3d6a6db0ecdcba65b572 2464747 wget_1.12.orig.tar.gz
 1e9b0c4c00eae6b4172baae219a14857f4002382b9d7a289de7ab789c402ad78 48308 wget_1.12-2.1.debian.tar.gz
Files: 
 141461b9c04e454dc8933c9d1f2abf83 2464747 wget_1.12.orig.tar.gz
 e93123c934e3c141916f472f380278c2 48308 wget_1.12-2.1.debian.tar.gz
\end{lstlisting}
\end{frame}

\subsection{Retrieving source packages}
\begin{frame}
\frametitle{Retrieving an existing source package}
\begin{itemize}
\item From the Debian archive:
	\begin{itemize}
		\item \texttt{apt-get source \textsl{package}}
		\item \texttt{apt-get source \textsl{package=version}}
		\item \texttt{apt-get source \textsl{package/release}}
	\end{itemize}
	(You need \texttt{deb-src} lines in \texttt{sources.list})
	\br
\item From the Internet:
	\begin{itemize}
		\item \texttt{dget \textsl{url-to.dsc}}
		\item \texttt{dget http://snapshot.debian.org/archive/debian-archive/\\20090802T004153Z/debian/dists/bo/main/source/web/\\wget\_1.4.4-6.dsc}\\
			(\href{http://snapshot.debian.org/}{\ttfamily snapshot.d.o} provides all packages from Debian since 2005)
	\end{itemize}
\br
\item Once downloaded, extract with \texttt{dpkg-source -x \textsl{file.dsc}}
\end{itemize}
\end{frame}

\subsection{Creating a basic source package}
\begin{frame}
\frametitle{Creating a basic source package}
\begin{itemize}
	\item Download the upstream source
		\hbr
	\item Rename to \texttt{\textsl{source\_package}\_\textsl{upstream\_version}.orig.tar.gz}
		\hbr
	\item Untar it
		\hbr
	\item \texttt{cd \textsl{upstream\_source} \&\& dh\_make} (from the \textbf{dh-make} package)
		\hbr
	\item \texttt{debian/} directory created, with lots of files in it
		\begin{itemize}
				\small
			\item That's where all the work will be done
		\end{itemize}
		\hbr
	\item There are some alternatives to \texttt{dh\_make} that target more specific sets of packages: \textbf{dh-make-perl}, \textbf{dh-make-php}, \ldots
\end{itemize}
\end{frame}

\begin{frame}
	\frametitle{Ideas dump}
\begin{itemize}
\item Debian source package -- files in debian/
\item Example: removing IPv6 support from wget
\item Packaging helpers: Debhelper7, CDBS
\item New source formats
\item Modifying the upstream source + patch systems
\item Per-language policies and packaging helpers
\item Maintainer scripts
\item Building packages -- dpkg-buildpackage pbuilder sbuild
\end{itemize}
\end{frame}

\section{Maintaining packages}
\begin{frame}
	\frametitle{Ideas dump 2}
\begin{itemize}
\item Uploading debsign / dput -- private archive -- reprepro
\item Uploading new packages in Debian and Ubuntu
\item Joining teams
\item Adopting packages
\item Contributing new stuff vs adopting (WNPP, etc) vs co-maintaining
\item Packaging with VCSes debcheckout debcommit debrelease git-buildpackage svn-buildpackage
\end{itemize}
\end{frame}

\begin{frame}
\frametitle{Becoming a Debian contributor}
Several ways to contribute:
\hbr
\begin{itemize}
\item Bring new software to Debian
\begin{itemize}
\item Is that new software interesting/useful enough?
\item Are there alternatives already packaged in Debian?
\end{itemize}
\br
\item Adopt existing unmaintained packages
\begin{itemize}
	\item Many unmaintained packages in Debian
	\item Including some that you rely on, probably
	\item Use \texttt{wnpp-alert} to find out if you have some installed
\end{itemize}
\br
\item Get involved in packaging teams
\begin{itemize}
\item Many teams that focus on set of packages
\item Full list on \url{http://wiki.debian.org/Teams}
\item An excellent way to work with more experienced contributors
\end{itemize}
\end{itemize}
\end{frame}

\begin{frame}
\frametitle{More interested in Ubuntu?}
\begin{itemize}
	\item Ubuntu mainly manages the divergence with Debian
	\br
	\item Do not really focus on specific packages\\
		Instead, collaborate with Debian teams
	\br
	\item Recommend uploading new packages to Debian first\\
	\fixme{ref}
	\br
	\item Possibly a better plan:
	\begin{itemize}
		\item Get involved in a Debian team and act as a bridge with Ubuntu
			\hbr
		\item Help reduce divergence, triage bugs in Launchpad
			\hbr
		\item Many Debian tools can help:
		\begin{itemize}
		\item Ubuntu column on the Developer' packages overview
		\item Ubuntu box on the Packages Tracking System
		\item Receive launchpad bugmail via the PTS
		\end{itemize}
	\end{itemize}
\end{itemize}
\end{frame}

\subsection{Adopting orphaned packages}
\begin{frame}{Adopting orphaned packages}
\begin{itemize}
	\item Full list: \fixme{ref}
	\item Installed on your machine: \texttt{wnpp-alert}
	\item Different states:
	\begin{itemize}
		\item \textbf{O}rphaned: the package is unmaintained\\
			Feel free to adopt it
		\item \textbf{RFA}: \textbf{R}equest \textbf{F}or \textbf{A}dopter\\
			Maintainer looking for adopter, but continues work in the meantime\\
			Feel free to adopt it. A mail to the current maintainer is polite
		\item \textbf{ITA}: \textbf{I}ntent \textbf{T}o \textbf{A}dopt\\
			Someone intends to adopt the package\\
			You could propose your help!
		\item \textbf{RFH} (\textbf{R}equest \textbf{F}or \textbf{H}elp\\
			The maintainer is looking for help
	\end{itemize}
	\item Some unmaintained packages not detected \arr Not orphaned yet
	\item Some packages are stalled in \textbf{ITA} state
	\item When in doubt, ask \texttt{debian-qa@lists.debian.org}
	\end{itemize}
\end{frame}

\section{Links}
\begin{frame}{Links}

http://wiki.debian.org/IntroDebianPackaging
http://www.debian.org/devel/
http://www.debian.org/doc/debian-policy/
http://www.debian.org/doc/developers-reference/
http://www.debian.org/doc/maint-guide/
https://wiki.ubuntu.com/PackagingGuide
lp:ubuntu-packaging-guide
debian-mentors
mentors.debian.net
library packaging guide
debhelper 7 slides
\end{frame}

\end{document}
